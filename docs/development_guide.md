# 抖音Web端界面UI定制工具 - 开发指南

本文档为抖音Web端界面UI定制工具的开发指南，旨在帮助开发者理解项目结构、开发流程和最佳实践。

## 项目概述

抖音Web端界面UI定制工具是一个基于油猴脚本的工具，允许用户自定义抖音Web端的界面元素，包括短视频页面和直播间页面的各种UI组件。

## 开发环境准备

### 基本要求

- Node.js 12.x 或更高版本
- npm 6.x 或更高版本
- Git
- 支持油猴扩展的浏览器（Chrome/Edge/Firefox）

### 环境配置

1. 克隆项目仓库：
   ```bash
   git clone https://github.com/SutChan/douyin_tool.git
   ```

2. 进入项目目录：
   ```bash
   cd douyin_tool
   ```

3. 安装依赖（如果有）：
   ```bash
   npm install
   ```

4. 构建项目：
   ```bash
   npm run build
   ```

## 项目结构详解

```
src/
  ├── main.js         # 主脚本入口，包含核心功能实现
  ├── config.js       # 配置管理模块，处理配置的保存和加载
  ├── ui_manager.js   # UI管理器模块，负责界面元素查找和定制
  ├── styles/
  │   ├── default.css # 默认主题样式
  │   └── dark.css    # 暗黑模式样式
  └── utils/
      ├── dom.js      # DOM操作工具函数
      └── storage.js  # 本地存储工具函数
dist/                 # 构建输出目录
docs/                 # 项目文档目录
build.js              # 构建脚本（支持自动版本号递增）
package.json          # 项目配置和依赖
install.html          # 一键安装页面
```

## 模块功能说明

### main.js

主脚本入口，负责：
- 初始化整个应用
- 注入样式
- 监听页面变化
- 创建浮动设置按钮
- 注册油猴菜单命令
- 处理版本更新检查

### config.js

配置管理模块，负责：
- 定义默认配置结构
- 处理配置的加载和保存
- 配置合并和验证
- 配置导入导出功能

### ui_manager.js

UI管理器模块，负责：
- 查找和操作页面元素
- 应用UI定制设置
- 创建设置面板
- 处理用户交互事件

### 样式文件

- `default.css`: 定义设置面板的默认样式
- `dark.css`: 定义暗黑模式下的设置面板样式

### 工具函数

- `dom.js`: 提供DOM操作相关的工具函数，如防抖函数
- `storage.js`: 提供安全的本地存储操作函数

## 开发流程

### 1. 代码修改

1. 修改源代码文件
2. 遵循项目的代码规范和注释标准
3. 确保所有函数都有适当的函数级注释

### 2. 构建与测试

1. 运行构建命令：
   ```bash
   npm run build
   ```
2. 构建脚本会自动递增版本号并生成新的用户脚本
3. 在浏览器中安装生成的脚本（位于`dist/douyin_ui_customizer.user.js`）
4. 访问抖音网页版测试功能

### 3. 调试技巧

- 使用浏览器开发者工具的控制台查看日志输出
- 利用`console.log()`在关键点输出信息
- 测试不同的抖音页面（短视频页面、直播间页面）
- 测试不同浏览器环境

## 代码规范

### 命名规范

- 变量和函数名：使用驼峰命名法（camelCase）
- 常量：使用全大写+下划线命名法（UPPER_SNAKE_CASE）
- 类名：使用大驼峰命名法（PascalCase）
- 文件命名：使用小写+下划线命名法（snake_case）或小写+连字符命名法（kebab-case）

### 注释规范

- 每个文件顶部添加文件描述注释
- 每个函数添加函数级注释，说明功能、参数和返回值
- 复杂逻辑添加行内注释
- 使用JSDoc格式的注释

### 错误处理

- 对可能出错的操作使用try-catch块
- 提供合理的错误处理和默认值
- 在控制台输出清晰的错误信息，便于调试

## 版本管理

### 版本号格式

项目使用语义化版本号规范（SemVer）：`主版本.次版本.修订版本`
- 主版本：不兼容的API更改
- 次版本：向下兼容的功能新增
- 修订版本：向下兼容的问题修正

### 自动版本管理

构建脚本会自动递增修订版本号，确保每次构建都有唯一的版本标识。版本号会同步到：
- package.json
- 油猴脚本头部
- main.js中的CURRENT_VERSION常量

## 性能优化

### DOM操作优化

- 减少不必要的DOM查询
- 使用防抖函数处理频繁触发的事件
- 批量修改DOM元素时考虑使用DocumentFragment

### 资源加载优化

- 最小化CSS和JavaScript
- 避免不必要的HTTP请求
- 优化脚本执行时机

## 兼容性考虑

- 考虑不同浏览器之间的差异
- 考虑抖音网站可能的结构变化
- 实现多种选择器策略以提高稳定性
- 添加适当的错误处理和降级机制

## 贡献指南

1. Fork项目仓库
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 提交Pull Request

## 常见问题

### Q: 如何处理抖音网站结构变更？

A: 实现多种元素查找策略，使用结构特征、文本内容和类名模式等多种方法定位元素，提高兼容性和稳定性。

### Q: 如何调试油猴脚本？

A: 在浏览器开发者工具的控制台中查看日志输出，使用`debugger`语句设置断点。

### Q: 如何测试不同浏览器的兼容性？

A: 在Chrome、Edge、Firefox等主流浏览器中安装油猴扩展并测试脚本功能。

## 作者

SutChan

## 许可证

MIT