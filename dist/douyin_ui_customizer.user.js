// ==UserScript==
// @name         douyin-ui-customizer
// @namespace    https://github.com/SutChan/douyin_tool
// @version      1.0.6
// @description  抖音Web端界面UI定制工具
// @author       SutChan
// @match        https://www.douyin.com/*
// @match        https://*.douyin.com/*
// @icon         https://www.douyin.com/favicon.ico
// @grant        GM_addStyle
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_registerMenuCommand
// @grant        GM_xmlhttpRequest
// @updateURL    https://github.com/SutChan/douyin_tool/raw/main/dist/douyin_ui_customizer.user.js
// @downloadURL  https://github.com/SutChan/douyin_tool/raw/main/dist/douyin_ui_customizer.user.js
// @license      MIT
// ==/UserScript==
/* eslint-disable */
// @ts-nocheck

const defaultStyles='/**\n * 抖音UI定制工具 - 默认样式\n */\n\n/* 设置面板样式 */\n.douyin-ui-customizer-panel {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 90%;\n  max-width: 800px;\n  max-height: 90vh;\n  background: #ffffff;\n  border-radius: 12px;\n  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n  z-index: 999999;\n  font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n.douyin-ui-customizer-panel .panel-header {\n  padding: 20px;\n  background: #000000;\n  color: #ffffff;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.douyin-ui-customizer-panel .panel-header h2 {\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n}\n\n.douyin-ui-customizer-panel .close-btn {\n  background: none;\n  border: none;\n  color: #ffffff;\n  font-size: 28px;\n  cursor: pointer;\n  padding: 0;\n  width: 30px;\n  height: 30px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 50%;\n  transition: background-color 0.2s;\n}\n\n.douyin-ui-customizer-panel .close-btn:hover {\n  background-color: rgba(255, 255, 255, 0.1);\n}\n\n.douyin-ui-customizer-panel .panel-content {\n  flex: 1;\n  padding: 20px;\n  overflow-y: auto;\n}\n\n.douyin-ui-customizer-panel .settings-tabs {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 20px;\n  border-bottom: 1px solid #e0e0e0;\n  padding-bottom: 10px;\n}\n\n.douyin-ui-customizer-panel .tab-btn {\n  background: #f5f5f5;\n  border: 1px solid #e0e0e0;\n  padding: 8px 16px;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s;\n  font-size: 14px;\n  font-weight: 500;\n}\n\n.douyin-ui-customizer-panel .tab-btn:hover {\n  background: #e8e8e8;\n}\n\n.douyin-ui-customizer-panel .tab-btn.active {\n  background: #000000;\n  color: #ffffff;\n  border-color: #000000;\n}\n\n.douyin-ui-customizer-panel .tab-content {\n  display: none;\n}\n\n.douyin-ui-customizer-panel .tab-content.active {\n  display: block;\n}\n\n.douyin-ui-customizer-panel .setting-group {\n  margin-bottom: 25px;\n  padding: 15px;\n  background: #fafafa;\n  border-radius: 8px;\n}\n\n.douyin-ui-customizer-panel .setting-group h3 {\n  margin-top: 0;\n  margin-bottom: 15px;\n  font-size: 16px;\n  font-weight: 600;\n  color: #333333;\n}\n\n.douyin-ui-customizer-panel label {\n  display: flex;\n  align-items: center;\n  margin-bottom: 10px;\n  cursor: pointer;\n  font-size: 14px;\n  color: #555555;\n  transition: color 0.2s;\n}\n\n.douyin-ui-customizer-panel label:hover {\n  color: #000000;\n}\n\n.douyin-ui-customizer-panel input[type="checkbox"],\n.douyin-ui-customizer-panel input[type="radio"] {\n  margin-right: 8px;\n  width: 16px;\n  height: 16px;\n}\n\n.douyin-ui-customizer-panel input[type="number"],\n.douyin-ui-customizer-panel input[type="text"],\n.douyin-ui-customizer-panel select {\n  margin-left: 8px;\n  padding: 6px 10px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  font-size: 14px;\n}\n\n.douyin-ui-customizer-panel input[type="range"] {\n  margin-left: 8px;\n  margin-right: 8px;\n  flex: 1;\n}\n\n.douyin-ui-customizer-panel input[type="color"] {\n  margin-left: 8px;\n  width: 40px;\n  height: 30px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  cursor: pointer;\n}\n\n.douyin-ui-customizer-panel .panel-footer {\n  padding: 20px;\n  background: #f8f8f8;\n  border-top: 1px solid #e0e0e0;\n  display: flex;\n  gap: 10px;\n  justify-content: flex-end;\n}\n\n.douyin-ui-customizer-panel .save-btn,\n.douyin-ui-customizer-panel .reset-btn {\n  padding: 10px 20px;\n  border: none;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.douyin-ui-customizer-panel .save-btn {\n  background: #000000;\n  color: #ffffff;\n}\n\n.douyin-ui-customizer-panel .save-btn:hover {\n  background: #333333;\n}\n\n.douyin-ui-customizer-panel .reset-btn {\n  background: #ffffff;\n  color: #666666;\n  border: 1px solid #ddd;\n}\n\n.douyin-ui-customizer-panel .reset-btn:hover {\n  background: #f0f0f0;\n  color: #333333;\n}\n\n.douyin-ui-customizer-panel button#exportBtn,\n.douyin-ui-customizer-panel button#importBtn {\n  padding: 8px 16px;\n  background: #000000;\n  color: #ffffff;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n  margin-bottom: 10px;\n  transition: background-color 0.2s;\n}\n\n.douyin-ui-customizer-panel button#exportBtn:hover,\n.douyin-ui-customizer-panel button#importBtn:hover {\n  background: #333333;\n}\n\n.douyin-ui-customizer-panel input[type="file"] {\n  margin-bottom: 10px;\n  padding: 8px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  font-size: 14px;\n}\n\n.douyin-ui-customizer-panel p {\n  font-size: 13px;\n  color: #777777;\n  margin-top: 5px;\n  line-height: 1.5;\n}\n\n/* 工具提示样式 */\n.douyin-ui-customizer-tooltip {\n  position: absolute;\n  background: rgba(0, 0, 0, 0.9);\n  color: #ffffff;\n  padding: 8px 12px;\n  border-radius: 4px;\n  font-size: 12px;\n  pointer-events: none;\n  z-index: 999999;\n  white-space: nowrap;\n}\n\n/* 滚动条样式 */\n.douyin-ui-customizer-panel ::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n.douyin-ui-customizer-panel ::-webkit-scrollbar-track {\n  background: #f1f1f1;\n  border-radius: 4px;\n}\n\n.douyin-ui-customizer-panel ::-webkit-scrollbar-thumb {\n  background: #888;\n  border-radius: 4px;\n}\n\n.douyin-ui-customizer-panel ::-webkit-scrollbar-thumb:hover {\n  background: #555;\n}\n\n/* 响应式设计 */\n@media (max-width: 600px) {\n  .douyin-ui-customizer-panel {\n    width: 95%;\n    max-width: none;\n    margin: 10px;\n    top: 10px;\n    left: 10px;\n    transform: none;\n    max-height: calc(100vh - 20px);\n  }\n  \n  .douyin-ui-customizer-panel .settings-tabs {\n    flex-wrap: wrap;\n  }\n  \n  .douyin-ui-customizer-panel .panel-footer {\n    flex-direction: column;\n  }\n  \n  .douyin-ui-customizer-panel .save-btn,\n  .douyin-ui-customizer-panel .reset-btn {\n    width: 100%;\n  }\n}',darkStyles='/**\n * 抖音UI定制工具 - 暗黑模式样式\n */\n\n/* 设置面板样式 */\n.douyin-ui-customizer-panel {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 90%;\n  max-width: 800px;\n  max-height: 90vh;\n  background: #1a1a1a;\n  border-radius: 12px;\n  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n  z-index: 999999;\n  font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n.douyin-ui-customizer-panel .panel-header {\n  padding: 20px;\n  background: #2d2d2d;\n  color: #ffffff;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-bottom: 1px solid #3d3d3d;\n}\n\n.douyin-ui-customizer-panel .panel-header h2 {\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n}\n\n.douyin-ui-customizer-panel .close-btn {\n  background: none;\n  border: none;\n  color: #ffffff;\n  font-size: 28px;\n  cursor: pointer;\n  padding: 0;\n  width: 30px;\n  height: 30px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 50%;\n  transition: background-color 0.2s;\n}\n\n.douyin-ui-customizer-panel .close-btn:hover {\n  background-color: rgba(255, 255, 255, 0.1);\n}\n\n.douyin-ui-customizer-panel .panel-content {\n  flex: 1;\n  padding: 20px;\n  overflow-y: auto;\n}\n\n.douyin-ui-customizer-panel .settings-tabs {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 20px;\n  border-bottom: 1px solid #3d3d3d;\n  padding-bottom: 10px;\n}\n\n.douyin-ui-customizer-panel .tab-btn {\n  background: #2d2d2d;\n  border: 1px solid #3d3d3d;\n  padding: 8px 16px;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s;\n  font-size: 14px;\n  font-weight: 500;\n  color: #cccccc;\n}\n\n.douyin-ui-customizer-panel .tab-btn:hover {\n  background: #3d3d3d;\n  color: #ffffff;\n}\n\n.douyin-ui-customizer-panel .tab-btn.active {\n  background: #ffffff;\n  color: #1a1a1a;\n  border-color: #ffffff;\n}\n\n.douyin-ui-customizer-panel .tab-content {\n  display: none;\n}\n\n.douyin-ui-customizer-panel .tab-content.active {\n  display: block;\n}\n\n.douyin-ui-customizer-panel .setting-group {\n  margin-bottom: 25px;\n  padding: 15px;\n  background: #2d2d2d;\n  border-radius: 8px;\n}\n\n.douyin-ui-customizer-panel .setting-group h3 {\n  margin-top: 0;\n  margin-bottom: 15px;\n  font-size: 16px;\n  font-weight: 600;\n  color: #ffffff;\n}\n\n.douyin-ui-customizer-panel label {\n  display: flex;\n  align-items: center;\n  margin-bottom: 10px;\n  cursor: pointer;\n  font-size: 14px;\n  color: #cccccc;\n  transition: color 0.2s;\n}\n\n.douyin-ui-customizer-panel label:hover {\n  color: #ffffff;\n}\n\n.douyin-ui-customizer-panel input[type="checkbox"],\n.douyin-ui-customizer-panel input[type="radio"] {\n  margin-right: 8px;\n  width: 16px;\n  height: 16px;\n}\n\n.douyin-ui-customizer-panel input[type="number"],\n.douyin-ui-customizer-panel input[type="text"],\n.douyin-ui-customizer-panel select {\n  margin-left: 8px;\n  padding: 6px 10px;\n  border: 1px solid #4d4d4d;\n  border-radius: 4px;\n  font-size: 14px;\n  background: #1a1a1a;\n  color: #ffffff;\n}\n\n.douyin-ui-customizer-panel input[type="number"]:focus,\n.douyin-ui-customizer-panel input[type="text"]:focus,\n.douyin-ui-customizer-panel select:focus {\n  outline: none;\n  border-color: #ffffff;\n}\n\n.douyin-ui-customizer-panel input[type="range"] {\n  margin-left: 8px;\n  margin-right: 8px;\n  flex: 1;\n}\n\n.douyin-ui-customizer-panel input[type="color"] {\n  margin-left: 8px;\n  width: 40px;\n  height: 30px;\n  border: 1px solid #4d4d4d;\n  border-radius: 4px;\n  cursor: pointer;\n}\n\n.douyin-ui-customizer-panel .panel-footer {\n  padding: 20px;\n  background: #2d2d2d;\n  border-top: 1px solid #3d3d3d;\n  display: flex;\n  gap: 10px;\n  justify-content: flex-end;\n}\n\n.douyin-ui-customizer-panel .save-btn,\n.douyin-ui-customizer-panel .reset-btn {\n  padding: 10px 20px;\n  border: none;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.douyin-ui-customizer-panel .save-btn {\n  background: #ffffff;\n  color: #1a1a1a;\n}\n\n.douyin-ui-customizer-panel .save-btn:hover {\n  background: #e0e0e0;\n}\n\n.douyin-ui-customizer-panel .reset-btn {\n  background: #1a1a1a;\n  color: #cccccc;\n  border: 1px solid #4d4d4d;\n}\n\n.douyin-ui-customizer-panel .reset-btn:hover {\n  background: #3d3d3d;\n  color: #ffffff;\n}\n\n.douyin-ui-customizer-panel button#exportBtn,\n.douyin-ui-customizer-panel button#importBtn {\n  padding: 8px 16px;\n  background: #ffffff;\n  color: #1a1a1a;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n  margin-bottom: 10px;\n  transition: background-color 0.2s;\n}\n\n.douyin-ui-customizer-panel button#exportBtn:hover,\n.douyin-ui-customizer-panel button#importBtn:hover {\n  background: #e0e0e0;\n}\n\n.douyin-ui-customizer-panel input[type="file"] {\n  margin-bottom: 10px;\n  padding: 8px;\n  border: 1px solid #4d4d4d;\n  border-radius: 4px;\n  font-size: 14px;\n  background: #1a1a1a;\n  color: #ffffff;\n}\n\n.douyin-ui-customizer-panel p {\n  font-size: 13px;\n  color: #999999;\n  margin-top: 5px;\n  line-height: 1.5;\n}\n\n/* 工具提示样式 */\n.douyin-ui-customizer-tooltip {\n  position: absolute;\n  background: rgba(255, 255, 255, 0.9);\n  color: #1a1a1a;\n  padding: 8px 12px;\n  border-radius: 4px;\n  font-size: 12px;\n  pointer-events: none;\n  z-index: 999999;\n  white-space: nowrap;\n}\n\n/* 滚动条样式 */\n.douyin-ui-customizer-panel ::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n.douyin-ui-customizer-panel ::-webkit-scrollbar-track {\n  background: #3d3d3d;\n  border-radius: 4px;\n}\n\n.douyin-ui-customizer-panel ::-webkit-scrollbar-thumb {\n  background: #666666;\n  border-radius: 4px;\n}\n\n.douyin-ui-customizer-panel ::-webkit-scrollbar-thumb:hover {\n  background: #888888;\n}\n\n/* 响应式设计 */\n@media (max-width: 600px) {\n  .douyin-ui-customizer-panel {\n    width: 95%;\n    max-width: none;\n    margin: 10px;\n    top: 10px;\n    left: 10px;\n    transform: none;\n    max-height: calc(100vh - 20px);\n  }\n  \n  .douyin-ui-customizer-panel .settings-tabs {\n    flex-wrap: wrap;\n  }\n  \n  .douyin-ui-customizer-panel .panel-footer {\n    flex-direction: column;\n  }\n  \n  .douyin-ui-customizer-panel .save-btn,\n  .douyin-ui-customizer-panel .reset-btn {\n    width: 100%;\n  }\n}';function $(n,e=document){try{return e.querySelector(n)}catch(e){return console.error(`DOM查询错误 (${n}):`,e),null}}function $$(n,e=document){try{return e.querySelectorAll(n)}catch(e){return console.error(`DOM查询错误 (${n}):`,e),new NodeList}}function createElement(n,e={},t=[]){const o=document.createElement(n);for(const[n,t]of Object.entries(e))n.startsWith("on")&&"function"==typeof t?o.addEventListener(n.slice(2).toLowerCase(),t):"style"===n&&"object"==typeof t?Object.assign(o.style,t):o.setAttribute(n,t);return"string"==typeof t?o.textContent=t:Array.isArray(t)&&t.forEach(n=>{n instanceof Node?o.appendChild(n):"string"==typeof n&&o.appendChild(document.createTextNode(n))}),o}function addClass(n,e){n&&n.classList&&(Array.isArray(e)?e.forEach(e=>n.classList.add(e)):n.classList.add(e))}function removeClass(n,e){n&&n.classList&&(Array.isArray(e)?e.forEach(e=>n.classList.remove(e)):n.classList.remove(e))}function toggleClass(n,e){return!(!n||!n.classList)&&n.classList.toggle(e)}function hasClass(n,e){return!(!n||!n.classList)&&n.classList.contains(e)}function addEventListener(n,e,t,o={}){n&&"function"==typeof n.addEventListener&&n.addEventListener(e,t,o)}function removeEventListener(n,e,t,o={}){n&&"function"==typeof n.removeEventListener&&n.removeEventListener(e,t,o)}function debounce(n,e){let t;return function(...o){clearTimeout(t),t=setTimeout(()=>{clearTimeout(t),n(...o)},e)}}function throttle(n,e){let t;return function(...o){t||(n.apply(this,o),t=!0,setTimeout(()=>t=!1,e))}}function getComputedStyle(n,e){if(!n)return"";return window.getComputedStyle(n).getPropertyValue(e)}function setStyle(n,e,t){if(n)try{n.style[e]=t}catch(n){console.error(`设置样式错误 (${e}):`,n)}}function setStyles(n,e){if(n)try{Object.assign(n.style,e)}catch(n){console.error("设置样式错误:",n)}}function isInViewport(n){if(!n)return!1;const e=n.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}function getElementPosition(n){if(!n)return{top:0,left:0};const e=n.getBoundingClientRect();return{top:e.top+window.pageYOffset,left:e.left+window.pageXOffset}}function removeElement(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function cloneElement(n,e=!0){if(!n)return null;try{return n.cloneNode(e)}catch(n){return console.error("克隆元素错误:",n),null}}function insertAfter(n,e){n&&e&&e.parentNode&&e.parentNode.insertBefore(n,e.nextSibling)}function insertBefore(n,e){n&&e&&e.parentNode&&e.parentNode.insertBefore(n,e)}function getItem(n,e=null){try{const t=localStorage.getItem(n);return null===t?e:JSON.parse(t)}catch(t){return console.error(`获取本地存储数据失败 (${n}):`,t),e}}function setItem(n,e){try{return localStorage.setItem(n,JSON.stringify(e)),!0}catch(e){return console.error(`设置本地存储数据失败 (${n}):`,e),!1}}function removeItem(n){try{return localStorage.removeItem(n),!0}catch(e){return console.error(`移除本地存储数据失败 (${n}):`,e),!1}}function clear(){try{return localStorage.clear(),!0}catch(n){return console.error("清空本地存储数据失败:",n),!1}}function hasItem(n){try{return null!==localStorage.getItem(n)}catch(e){return console.error(`检查存储键失败 (${n}):`,e),!1}}function getAllKeys(){try{const n=[];for(let e=0;e<localStorage.length;e++)n.push(localStorage.key(e));return n}catch(n){return console.error("获取所有存储键失败:",n),[]}}function getItems(n){const e={};return n.forEach(n=>{e[n]=getItem(n)}),e}function setItems(n){let e=!0;return Object.entries(n).forEach(([n,t])=>{setItem(n,t)||(e=!1)}),e}function removeItems(n){let e=!0;return n.forEach(n=>{removeItem(n)||(e=!1)}),e}function getStorageInfo(){try{let n=0;for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e),o=localStorage.getItem(t);n+=t.length+o.length}return{itemCount:localStorage.length,totalSize:n,totalSizeKB:(n/1024).toFixed(2),quota:getStorageQuota()}}catch(n){return console.error("获取存储信息失败:",n),{itemCount:0,totalSize:0,totalSizeKB:"0",quota:null}}}function getStorageQuota(){try{return 5242880}catch(n){return console.error("获取存储配额失败:",n),null}}function isStorageAvailable(){try{const n="__storage_test__";return localStorage.setItem(n,n),localStorage.removeItem(n),!0}catch(n){return!1}}function setItemWithExpiry(n,e,t){return setItem(n,{value:e,expiry:Date.now()+t})}function getItemWithExpiry(n,e=null){const t=getItem(n);return t&&"object"==typeof t&&t.hasOwnProperty("expiry")?Date.now()>t.expiry?(removeItem(n),e):t.value:e}function saveConfigWithVersion(n,e,t){return setItem(`${n}_config`,{version:t,config:e,savedAt:(new Date).toISOString()})}function loadConfigWithVersion(n,e,t){const o=getItem(`${n}_config`);return o&&o.version===t?o.config:e}function exportStorageToJson(n="storage-export.json"){try{const e={};for(let n=0;n<localStorage.length;n++){const t=localStorage.key(n);e[t]=getItem(t)}const t=JSON.stringify(e,null,2),o=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(o),r=document.createElement("a");r.href=i,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}catch(n){console.error("导出存储数据失败:",n)}}function importStorageFromJson(n,e){const t=new FileReader;t.onload=function(n){try{const t=JSON.parse(n.target.result);clear(),Object.entries(t).forEach(([n,e])=>{setItem(n,e)}),e(!0)}catch(n){console.error("导入存储数据失败:",n),e(!1,n)}},t.onerror=function(){e(!1,new Error("文件读取失败"))},t.readAsText(n)}const DEFAULT_CONFIG={theme:"light",videoUI:{showLikeButton:!0,showCommentButton:!0,showShareButton:!0,showAuthorInfo:!0,showMusicInfo:!0,showDescription:!0,showRecommendations:!0,layout:"default",controlBar:{show:!0,autoHide:!0,position:"bottom"}},liveUI:{showGifts:!0,showDanmaku:!0,showRecommendations:!0,showAds:!1,showStats:!0,danmaku:{fontSize:16,color:"#FFFFFF",opacity:.8,speed:"medium",position:"top"},layout:"default"},general:{autoPlay:!0,autoScroll:!1,keyboardShortcuts:!0,notifications:!1}};function loadConfig(){try{const n=GM_getValue("douyin_ui_customizer_config");return n?mergeConfig(n,DEFAULT_CONFIG):DEFAULT_CONFIG}catch(n){return console.error("加载配置失败：",n),DEFAULT_CONFIG}}function saveConfig(n){try{GM_setValue("douyin_ui_customizer_config",n),console.log("配置已保存")}catch(n){console.error("保存配置失败：",n)}}function resetConfig(){try{return GM_setValue("douyin_ui_customizer_config",DEFAULT_CONFIG),console.log("配置已重置为默认值"),DEFAULT_CONFIG}catch(n){return console.error("重置配置失败：",n),DEFAULT_CONFIG}}function mergeConfig(n,e){const t={...e};for(const o in n)n.hasOwnProperty(o)&&("object"!=typeof n[o]||null===n[o]||"object"!=typeof e[o]||null===e[o]||Array.isArray(n[o])||Array.isArray(e[o])?t[o]=n[o]:t[o]=mergeConfig(n[o],e[o]));return t}function exportConfig(){const n=loadConfig();return JSON.stringify(n,null,2)}function importConfig(n){try{return saveConfig(JSON.parse(n)),!0}catch(n){return console.error("导入配置失败：",n),!1}}class UIManager{constructor(n){this.config=n,this.settingsPanel=null}applyVideoCustomizations(){if(console.log("应用短视频界面定制"),!this.config.videoUI)return;const{videoUI:n}=this.config;this.toggleElement(".like-button",n.showLikeButton),this.toggleElement(".comment-button",n.showCommentButton),this.toggleElement(".share-button",n.showShareButton),this.toggleElement(".author-info",n.showAuthorInfo),this.toggleElement(".music-info",n.showMusicInfo),this.toggleElement(".video-description",n.showDescription),this.toggleElement(".video-recommendations",n.showRecommendations),n.controlBar&&this.customizeControlBar(n.controlBar),this.applyLayout("video",n.layout)}applyLiveCustomizations(){if(console.log("应用直播间界面定制"),!this.config.liveUI)return;const{liveUI:n}=this.config;this.toggleElement(".gift-animation, .gift-container, .gift-item, .gift-area, .gift-panel, .gift-button, .gift-box, .gift-effect",n.showGifts),this.toggleElement(".danmaku-container",n.showDanmaku),this.toggleElement(".live-recommendations",n.showRecommendations),this.toggleElement(".live-ads",n.showAds),this.toggleElement(".live-stats",n.showStats),n.danmaku&&this.customizeDanmaku(n.danmaku),this.applyLayout("live",n.layout)}toggleElement(n,e){document.querySelectorAll(n).forEach(n=>{e?(n.style.display="",n.style.visibility="visible"):(n.style.display="none",n.style.visibility="hidden")})}customizeControlBar(n){const e=document.querySelector(".video-control-bar");if(e)if(n.show){if(n.position)switch(e.style.position="absolute",n.position){case"top":e.style.top="0",e.style.bottom="auto";break;case"bottom":e.style.bottom="0",e.style.top="auto";break;default:e.style.bottom="0"}n.autoHide}else e.style.display="none"}customizeDanmaku(n){const e="douyin-danmaku-custom-styles";let t=document.getElementById(e);t||(t=document.createElement("style"),t.id=e,document.head.appendChild(t));let o="";if(n.fontSize&&(o+=`.danmaku { font-size: ${n.fontSize}px !important; }`),n.color&&(o+=`.danmaku { color: ${n.color} !important; }`),n.opacity&&(o+=`.danmaku { opacity: ${n.opacity} !important; }`),n.speed){let e=6;switch(n.speed){case"fast":e=3;break;case"slow":e=10;break;default:e=6}o+=`.danmaku { animation-duration: ${e}s !important; }`}t.textContent=o}applyLayout(n,e){e&&"default"!==e&&console.log(`应用${n}布局：${e}`)}showSettingsPanel(){this.settingsPanel&&this.settingsPanel.remove(),this.settingsPanel=this.createSettingsPanel(),document.body.appendChild(this.settingsPanel)}createSettingsPanel(){const n=document.createElement("div");return n.className="douyin-ui-customizer-panel",n.innerHTML=`\n      <div class="panel-header">\n        <h2>抖音UI定制设置</h2>\n        <button class="close-btn">×</button>\n      </div>\n      <div class="panel-content">\n        <div class="settings-tabs">\n          <button class="tab-btn active" data-tab="general">通用设置</button>\n          <button class="tab-btn" data-tab="video">短视频设置</button>\n          <button class="tab-btn" data-tab="live">直播间设置</button>\n          <button class="tab-btn" data-tab="import-export">导入导出</button>\n        </div>\n        \n        <div class="tab-content active" id="general-tab">\n          ${this.createGeneralSettings()}\n        </div>\n        \n        <div class="tab-content" id="video-tab">\n          ${this.createVideoSettings()}\n        </div>\n        \n        <div class="tab-content" id="live-tab">\n          ${this.createLiveSettings()}\n        </div>\n        \n        <div class="tab-content" id="import-export-tab">\n          ${this.createImportExportSettings()}\n        </div>\n      </div>\n      <div class="panel-footer">\n        <button class="save-btn">保存设置</button>\n        <button class="reset-btn">重置为默认</button>\n      </div>\n    `,this.setupSettingsPanelEvents(n),n}setupSettingsPanelEvents(n){n.querySelector(".close-btn").addEventListener("click",()=>{n.remove()}),n.querySelectorAll(".tab-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-tab");n.querySelectorAll(".tab-btn").forEach(n=>n.classList.remove("active")),n.querySelectorAll(".tab-content").forEach(n=>n.classList.remove("active")),e.classList.add("active"),n.querySelector(`#${t}-tab`).classList.add("active")})}),n.querySelector(".save-btn").addEventListener("click",()=>{this.saveSettings(n)}),n.querySelector(".reset-btn").addEventListener("click",()=>{confirm("确定要重置所有设置吗？")&&(this.config=resetConfig(),n.remove(),location.reload())}),this.makePanelDraggable(n)}makePanelDraggable(n){const e=n.querySelector(".panel-header");let t,o,i=!1;e.addEventListener("mousedown",r=>{i=!0;const a=n.getBoundingClientRect();t=r.clientX-a.left,o=r.clientY-a.top,"fixed"!==n.style.position&&(n.style.position="fixed"),e.style.cursor="grabbing"}),document.addEventListener("mousemove",e=>{if(!i)return;let r=e.clientX-t,a=e.clientY-o;const s=n.getBoundingClientRect(),c=window.innerWidth,l=window.innerHeight;r=Math.max(0,Math.min(r,c-s.width)),a=Math.max(0,Math.min(a,l-s.height)),n.style.left=`${r}px`,n.style.top=`${a}px`,n.style.right="auto",n.style.bottom="auto"}),document.addEventListener("mouseup",()=>{i&&(i=!1,e.style.cursor="grab")}),e.style.cursor="grab",e.addEventListener("selectstart",n=>{n.preventDefault()})}createGeneralSettings(){return`\n      <div class="setting-group">\n        <h3>主题设置</h3>\n        <label>\n          <input type="radio" name="theme" value="light" ${"light"===this.config.theme?"checked":""}>\n          浅色主题\n        </label>\n        <label>\n          <input type="radio" name="theme" value="dark" ${"dark"===this.config.theme?"checked":""}>\n          深色主题\n        </label>\n      </div>\n      \n      <div class="setting-group">\n        <h3>播放设置</h3>\n        <label>\n          <input type="checkbox" id="autoPlay" ${this.config.general?.autoPlay?"checked":""}>\n          自动播放视频\n        </label>\n        <label>\n          <input type="checkbox" id="autoScroll" ${this.config.general?.autoScroll?"checked":""}>\n          自动滚动到下一个视频\n        </label>\n      </div>\n      \n      <div class="setting-group">\n        <h3>功能设置</h3>\n        <label>\n          <input type="checkbox" id="keyboardShortcuts" ${this.config.general?.keyboardShortcuts?"checked":""}>\n          启用键盘快捷键\n        </label>\n        <label>\n          <input type="checkbox" id="notifications" ${this.config.general?.notifications?"checked":""}>\n          启用通知提醒\n        </label>\n      </div>\n    `}createVideoSettings(){return`\n      <div class="setting-group">\n        <h3>显示元素</h3>\n        <label>\n          <input type="checkbox" id="showLikeButton" ${this.config.videoUI?.showLikeButton?"checked":""}>\n          显示点赞按钮\n        </label>\n        <label>\n          <input type="checkbox" id="showCommentButton" ${this.config.videoUI?.showCommentButton?"checked":""}>\n          显示评论按钮\n        </label>\n        <label>\n          <input type="checkbox" id="showShareButton" ${this.config.videoUI?.showShareButton?"checked":""}>\n          显示分享按钮\n        </label>\n        <label>\n          <input type="checkbox" id="showAuthorInfo" ${this.config.videoUI?.showAuthorInfo?"checked":""}>\n          显示作者信息\n        </label>\n        <label>\n          <input type="checkbox" id="showMusicInfo" ${this.config.videoUI?.showMusicInfo?"checked":""}>\n          显示音乐信息\n        </label>\n        <label>\n          <input type="checkbox" id="showDescription" ${this.config.videoUI?.showDescription?"checked":""}>\n          显示视频描述\n        </label>\n        <label>\n          <input type="checkbox" id="showRecommendations" ${this.config.videoUI?.showRecommendations?"checked":""}>\n          显示推荐视频\n        </label>\n      </div>\n      \n      <div class="setting-group">\n        <h3>控制栏设置</h3>\n        <label>\n          <input type="checkbox" id="controlBarShow" ${this.config.videoUI?.controlBar?.show?"checked":""}>\n          显示控制栏\n        </label>\n        <label>\n          <input type="checkbox" id="controlBarAutoHide" ${this.config.videoUI?.controlBar?.autoHide?"checked":""}>\n          自动隐藏控制栏\n        </label>\n        <label>\n          <select id="controlBarPosition">\n            <option value="bottom" ${"bottom"===this.config.videoUI?.controlBar?.position?"selected":""}>底部</option>\n            <option value="top" ${"top"===this.config.videoUI?.controlBar?.position?"selected":""}>顶部</option>\n          </select>\n          控制栏位置\n        </label>\n      </div>\n    `}createLiveSettings(){return`\n      <div class="setting-group">\n        <h3>显示元素</h3>\n        <label>\n          <input type="checkbox" id="showGifts" ${this.config.liveUI?.showGifts?"checked":""}>\n          显示礼物动画\n        </label>\n        <label>\n          <input type="checkbox" id="showDanmaku" ${this.config.liveUI?.showDanmaku?"checked":""}>\n          显示弹幕\n        </label>\n        <label>\n          <input type="checkbox" id="showRecommendations" ${this.config.liveUI?.showRecommendations?"checked":""}>\n          显示推荐直播\n        </label>\n        <label>\n          <input type="checkbox" id="showAds" ${this.config.liveUI?.showAds?"checked":""}>\n          显示广告\n        </label>\n        <label>\n          <input type="checkbox" id="showStats" ${this.config.liveUI?.showStats?"checked":""}>\n          显示统计信息\n        </label>\n      </div>\n      \n      <div class="setting-group">\n        <h3>弹幕设置</h3>\n        <label>\n          <input type="number" id="danmakuFontSize" min="12" max="36" value="${this.config.liveUI?.danmaku?.fontSize||16}">\n          字体大小（px）\n        </label>\n        <label>\n          <input type="color" id="danmakuColor" value="${this.config.liveUI?.danmaku?.color||"#FFFFFF"}">\n          字体颜色\n        </label>\n        <label>\n          <input type="range" id="danmakuOpacity" min="0.1" max="1" step="0.1" value="${this.config.liveUI?.danmaku?.opacity||.8}">\n          透明度: <span id="opacityValue">${this.config.liveUI?.danmaku?.opacity||.8}</span>\n        </label>\n        <label>\n          <select id="danmakuSpeed">\n            <option value="slow" ${"slow"===this.config.liveUI?.danmaku?.speed?"selected":""}>慢速</option>\n            <option value="medium" ${"medium"===this.config.liveUI?.danmaku?.speed?"selected":""}>中速</option>\n            <option value="fast" ${"fast"===this.config.liveUI?.danmaku?.speed?"selected":""}>快速</option>\n          </select>\n          弹幕速度\n        </label>\n      </div>\n    `}createImportExportSettings(){return'\n      <div class="setting-group">\n        <h3>导出配置</h3>\n        <button id="exportBtn">导出配置</button>\n        <p>点击按钮导出当前配置到JSON文件</p>\n      </div>\n      \n      <div class="setting-group">\n        <h3>导入配置</h3>\n        <input type="file" id="importFile" accept=".json">\n        <button id="importBtn">导入配置</button>\n        <p>选择JSON配置文件并点击导入</p>\n      </div>\n    '}showNotification(n,e="success"){const t=document.createElement("div");t.className=`douyin-ui-customizer-notification notification-${e}`,t.textContent=n,Object.assign(t.style,{position:"fixed",top:"20px",right:"20px",padding:"12px 20px",borderRadius:"6px",color:"#fff",fontSize:"14px",fontWeight:"500",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:"999999",opacity:"0",transform:"translateX(100%)",transition:"all 0.3s ease-out",backgroundColor:"success"===e?"#52c41a":"error"===e?"#ff4d4f":"#1890ff",maxWidth:"300px",wordWrap:"break-word"}),document.body.appendChild(t),setTimeout(()=>{Object.assign(t.style,{opacity:"1",transform:"translateX(0)"})},10),setTimeout(()=>{Object.assign(t.style,{opacity:"0",transform:"translateX(100%)"}),setTimeout(()=>{t.remove()},300)},3e3)}saveSettings(n){try{this.config.theme=n.querySelector('input[name="theme"]:checked').value,this.config.general||(this.config.general={}),this.config.general.autoPlay=n.querySelector("#autoPlay").checked,this.config.general.autoScroll=n.querySelector("#autoScroll").checked,this.config.general.keyboardShortcuts=n.querySelector("#keyboardShortcuts").checked,this.config.general.notifications=n.querySelector("#notifications").checked,this.config.videoUI||(this.config.videoUI={}),this.config.videoUI.showLikeButton=n.querySelector("#showLikeButton").checked,this.config.videoUI.showCommentButton=n.querySelector("#showCommentButton").checked,this.config.videoUI.showShareButton=n.querySelector("#showShareButton").checked,this.config.videoUI.showAuthorInfo=n.querySelector("#showAuthorInfo").checked,this.config.videoUI.showMusicInfo=n.querySelector("#showMusicInfo").checked,this.config.videoUI.showDescription=n.querySelector("#showDescription").checked,this.config.videoUI.showRecommendations=n.querySelector("#showRecommendations").checked,this.config.videoUI.controlBar||(this.config.videoUI.controlBar={}),this.config.videoUI.controlBar.show=n.querySelector("#controlBarShow").checked,this.config.videoUI.controlBar.autoHide=n.querySelector("#controlBarAutoHide").checked,this.config.videoUI.controlBar.position=n.querySelector("#controlBarPosition").value,this.config.liveUI||(this.config.liveUI={}),this.config.liveUI.showGifts=n.querySelector("#showGifts").checked,this.config.liveUI.showDanmaku=n.querySelector("#showDanmaku").checked,this.config.liveUI.showRecommendations=n.querySelector("#showRecommendations").checked,this.config.liveUI.showAds=n.querySelector("#showAds").checked,this.config.liveUI.showStats=n.querySelector("#showStats").checked,this.config.liveUI.danmaku||(this.config.liveUI.danmaku={}),this.config.liveUI.danmaku.fontSize=parseInt(n.querySelector("#danmakuFontSize").value),this.config.liveUI.danmaku.color=n.querySelector("#danmakuColor").value,this.config.liveUI.danmaku.opacity=parseFloat(n.querySelector("#danmakuOpacity").value),this.config.liveUI.danmaku.speed=n.querySelector("#danmakuSpeed").value,saveConfig(this.config),setTimeout(()=>{if(injectStyles(this.config.theme),isVideoPage()){const n=document.getElementById("douyin-ui-customizer-custom");n&&n.remove(),this.applyVideoCustomizations()}if(isLivePage()){const n=document.getElementById("douyin-ui-customizer-custom");n&&n.remove(),this.applyLiveCustomizations()}this.showNotification("设置已成功保存并应用！","success"),setTimeout(()=>{n.remove()},300)},100)}catch(n){console.error("保存设置失败:",n),this.showNotification("保存设置失败，请重试","error")}}}const CURRENT_VERSION="1.0.1",UPDATE_CHECK_INTERVAL=864e5;async function checkForUpdates(n=!1){try{const e="https://github.com/SutChan/douyin_tool/raw/main/dist/douyin_ui_customizer.user.js";GM_xmlhttpRequest({method:"GET",url:e,onload:function(t){if(200===t.status){const o=t.responseText.match(/@version\s+(\d+\.\d+\.\d+)/i);if(o&&o[1]){const t=o[1];isNewerVersion(t,"1.0.1")?confirm(`发现新版本 ${t}！是否更新脚本？\n\n当前版本：1.0.1`)&&window.open(e,"_blank"):n&&alert("您的脚本已是最新版本！")}}},onerror:function(){n&&alert("检查更新失败，请稍后重试。")}})}catch(n){console.error("检查更新时发生错误：",n)}}function isNewerVersion(n,e){const t=n.split(".").map(Number),o=e.split(".").map(Number);for(let n=0;n<t.length;n++){if(t[n]>o[n])return!0;if(t[n]<o[n])return!1}return!1}function shouldCheckForUpdates(){const n=getItem("lastUpdateCheckTime",0),e=Date.now();return e-n>864e5&&(setItem("lastUpdateCheckTime",e),!0)}function init(){console.log("抖音UI定制工具已启动");const n=loadConfig(),e=new UIManager(n);injectStyles(n.theme),observePageChanges(e),registerMenuCommands(e),shouldCheckForUpdates()&&checkForUpdates(!1)}function injectStyles(n){const e=document.getElementById("douyin-ui-customizer-styles");e&&e.remove();const t=document.createElement("style");t.id="douyin-ui-customizer-styles",t.textContent="dark"===n?darkStyles:defaultStyles,document.head.appendChild(t);const o=document.createElement("style");o.id="douyin-ui-customizer-custom",o.textContent=generateCustomStyles(),document.head.appendChild(o)}function generateCustomStyles(){const n=loadConfig();let e="";return n.videoUI&&(n.videoUI.showLikeButton||(e+=".like-button { display: none !important; }"),n.videoUI.showCommentButton||(e+=".comment-button { display: none !important; }"),n.videoUI.showShareButton||(e+=".share-button { display: none !important; }"),n.videoUI.showAuthorInfo||(e+=".author-info { display: none !important; }"),n.videoUI.layout),n.liveUI&&(n.liveUI.showGifts||(e+=".gift-animation, .gift-container { display: none !important; }"),n.liveUI.showRecommendations||(e+=".live-recommendations, .live-ads { display: none !important; }"),n.liveUI.danmaku&&(n.liveUI.danmaku.fontSize&&(e+=`.danmaku { font-size: ${n.liveUI.danmaku.fontSize}px !important; }`),n.liveUI.danmaku.color&&(e+=`.danmaku { color: ${n.liveUI.danmaku.color} !important; }`))),e}function observePageChanges(n){new MutationObserver(e=>{isVideoPage()&&n.applyVideoCustomizations(),isLivePage()&&n.applyLiveCustomizations()}).observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{isVideoPage()&&n.applyVideoCustomizations(),isLivePage()&&n.applyLiveCustomizations()},1e3)}function isVideoPage(){return location.pathname.includes("/video/")||"/"===location.pathname||location.pathname.includes("/user/")}function isLivePage(){return location.pathname.includes("/live/")}function registerMenuCommands(n){GM_registerMenuCommand("打开设置面板",()=>{n.showSettingsPanel()}),GM_registerMenuCommand("切换暗黑模式",()=>{const n=loadConfig();n.theme="dark"===n.theme?"light":"dark",saveConfig(n),injectStyles(n.theme)}),GM_registerMenuCommand("检查更新",()=>{checkForUpdates(!0)}),GM_registerMenuCommand("重置所有设置",()=>{confirm("确定要重置所有设置吗？")&&(resetConfig(),location.reload())})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",init):init();